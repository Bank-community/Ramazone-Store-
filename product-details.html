<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Product Details - Ramazone</title>
    <meta property="og:title" content="Ramazone">
    <meta property="og:image" content="https://i.ibb.co/My6h0gdd/20250706-230221.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="py-3 flex items-center justify-between">
                <a href="./products.html" class="text-gray-600 hover:text-gray-900"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></a>
                <a href="./index.html"><img src="https://i.ibb.co/My6h0gdd/20250706-230221.png" alt="Ramazone Logo" style="max-height: 35px; border-radius: 0;"></a>
                <div class="w-6"></div>
            </div>
        </div>
    </header>

    <main id="product-content" class="max-w-7xl mx-auto sm:px-6 lg:px-8 mt-0 sm:mt-2 mb-12 pb-28" style="display: none;">
        <div class="bg-white sm:rounded-2xl sm:shadow-lg overflow-hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2">
                <div class="p-0 sm:p-4 lg:p-6">
                    <div id="main-media-wrapper" class="rounded-none sm:rounded-xl mb-4 cursor-pointer overflow-hidden relative">
                        <div id="media-slider"></div>
                    </div>
                    <div class="relative px-4 sm:px-0">
                        <div class="grid grid-cols-5 gap-2 sm:gap-4" id="thumbnail-gallery"></div>
                    </div>
                </div>

                <div class="flex flex-col p-4 sm:p-6 lg:p-8">
                    <div class="flex justify-between items-start mb-2">
                        <h1 id="product-title" class="text-2xl sm:text-3xl font-bold text-gray-900 leading-tight"></h1>
                        <button id="share-button" title="Share Product" class="flex-shrink-0 bg-gray-100 rounded-full w-11 h-11 flex items-center justify-center hover:bg-gray-200 transition"><img src="https://www.svgrepo.com/show/527876/share.svg" class="w-6 h-6" alt="Share Icon"></button>
                    </div>

                    <div id="rating-section" class="flex items-center gap-2 text-sm text-gray-500 mb-4" style="display: none;">
                        <div id="product-rating-stars" class="rating-stars"></div>
                        <span id="product-review-count"></span>
                    </div>

                    <div id="variant-selection-section" class="mb-4" style="display: none;">
                        <div id="variant-buttons-container" class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>
                    </div>

                    <div class="space-y-3 border-t border-b border-gray-200 py-3 my-3">
                        <div id="new-price-section">
                             <div id="lowest-price-tag-container" style="display: none;">
                                <div class="lowest-price-tag">Lowest Price since Launch</div>
                            </div>
                            <div class="flex items-center gap-3 mb-2">
                                <span id="price-percentage-discount" class="text-2xl font-bold text-green-600 flex items-center"></span>
                                <span id="price-original" class="text-xl text-gray-400 line-through"></span>
                                <span id="price-final" class="text-3xl font-extrabold text-gray-900"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="advanced-highlights-section" class="border-t border-gray-200" style="display: none;">
                </div>

            <div id="description-section" class="border-t border-gray-200 p-4 sm:p-6 lg:p-8" style="display: none;">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Product Details</h2>
                <div id="product-description" class="space-y-6"></div>
            </div>
        </div>

        <div id="recently-viewed-section" class="max-w-7xl mx-auto px-4 sm:px-0 mt-12" style="display: none;"><h2 class="text-2xl font-bold text-gray-800 mb-4">Recently Viewed</h2><div id="recently-viewed-container" class="carousel-container pb-4"></div></div>
        <div id="similar-products-section" class="max-w-7xl mx-auto px-4 sm:px-0 mt-12" style="display: none;"><h2 class="text-2xl font-bold text-gray-800 mb-4">Similar Products</h2><div id="similar-products-container" class="carousel-container pb-4"></div></div>
        <div id="other-products-section" class="max-w-7xl mx-auto px-4 sm:px-0 mt-12" style="display: none;"><h2 class="text-2xl font-bold text-gray-800 mb-4">Other Products</h2><div id="other-products-container" class="grid grid-cols-2 gap-3 sm:gap-4"></div></div>
    </main>

    <div id="loading-indicator" class="text-center py-20"><p class="text-lg font-semibold">Product load ho raha hai...</p></div>

    <div id="image-modal"><span class="close">×</span><a class="modal-nav prev">❮</a><img id="modal-image-content"><a class="modal-nav next">❯</a></div>
    <div id="toast-notification"></div>
    <div id="variant-modal-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-[1001] flex justify-center items-center p-4 hidden"><div id="variant-modal-content" class="bg-white rounded-xl shadow-2xl w-full max-w-sm max-h-[80vh] flex flex-col transform scale-95 opacity-0 transition-all duration-300"><div class="flex justify-between items-center p-4 border-b"><h3 id="variant-modal-title" class="text-lg font-bold">Select Option</h3><button id="variant-modal-close" class="text-gray-500 hover:text-gray-800 text-2xl">×</button></div><div id="variant-modal-body" class="p-4 overflow-y-auto space-y-3"></div></div></div>
    <div id="sticky-action-bar" class="fixed bottom-0 left-0 w-full bg-white/80 backdrop-blur-sm shadow-[0_-2px_10px_rgba(0,0,0,0.1)] p-3 z-40 border-t border-gray-200"><div class="max-w-7xl mx-auto px-4"><div class="grid grid-cols-2 gap-3"><div class="flex items-center justify-center"><div class="quantity-selector inline-flex items-center justify-center bg-white rounded-lg shadow-sm"><button id="decrease-quantity" class="rounded-l-lg">-</button><span id="quantity-display" class="text-center px-4 py-2 border-t border-b border-gray-200">1</span><button id="increase-quantity" class="rounded-r-lg">+</button></div></div><a id="order-now-link" href="#" class="whatsapp-btn w-full flex items-center justify-center text-white font-bold py-3 px-4 rounded-xl text-lg shadow-lg"><i class="fab fa-whatsapp text-2xl mr-2"></i> Order Now</a></div></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // --- GLOBAL STATE ---
        let mediaItems = [], currentMediaIndex = 0, productQuantity = 1, currentProductData = null, currentProductId = null;
        let allProductsCache = [], validCoupons = [];
        let selectedVariants = {};
        let ramazoneDeliveryCharge = 10;
        let appThemeColor = '#4F46E5';
        let database;

        const slider = document.getElementById('media-slider');
        const sliderWrapper = document.getElementById('main-media-wrapper');
        let isDragging = false, startPos = 0, currentTranslate = 0, prevTranslate = 0, animationID;

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', initializeApp);

        async function initializeApp() {
            try {
                const response = await fetch('/api/firebase-config');
                if (!response.ok) throw new Error(`Server responded with status: ${response.status}`);
                const firebaseConfig = await response.json();
                if (firebaseConfig.apiKey) {
                    firebase.initializeApp(firebaseConfig);
                    database = firebase.database();
                    loadPageData();
                } else {
                    throw new Error("Firebase config is missing or invalid.");
                }
            } catch (error) {
                console.error("Initialization or data fetch failed:", error);
                document.getElementById('loading-indicator').innerHTML = '<p class="text-red-500">Could not initialize application.</p>';
            }
        }

        async function loadPageData() {
            await fetchAllData(database);
            fetchProductData();
        }

        async function fetchAllData(db) {
            const dbRef = db.ref('ramazone');
            const snapshot = await dbRef.get();
            if (snapshot.exists()) {
                const data = snapshot.val();
                const config = data.config || {};
                ramazoneDeliveryCharge = config.deliveryCharge || 10;
                appThemeColor = config.themeColor || '#4F46E5';
                applyTheme(appThemeColor);
                allProductsCache = Object.values(data.products || {});
            }
        }

        function applyTheme(color) {
            document.documentElement.style.setProperty('--primary-color', color);
        }

        function fetchProductData() {
            const params = new URLSearchParams(window.location.search);
            let idFromUrl = params.get('id');
            if (idFromUrl) currentProductId = idFromUrl.trim();

            if (!currentProductId) {
                document.getElementById('loading-indicator').innerHTML = '<p class="text-center text-red-500 font-bold">Koi product ID nahi mila.</p>';
                return;
            }
            if (allProductsCache.length === 0) {
                document.getElementById('loading-indicator').innerHTML = '<p class="text-center text-red-500 font-bold">Product catalog load nahi hua. Refresh karke try karein.</p>';
                return;
            }
            const product = allProductsCache.find(p => p.id == currentProductId);
            if (product) {
                currentProductData = product;
                loadProduct(currentProductData);
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('product-content').style.display = 'block';
            } else {
                console.error(`Product with ID "${currentProductId}" not found in cache.`);
                document.getElementById('loading-indicator').innerHTML = '<p class="text-center text-red-500 font-bold">Maaf kijiye, yeh product nahi mil saka.</p>';
            }
        }

        function loadProduct(data) {
            document.title = `${data.name || "Product"} - Ramazone`;
            document.querySelector('meta[property="og:title"]').setAttribute("content", data.name);
            document.querySelector('meta[property="og:image"]').setAttribute("content", data.images?.[0] || "https://i.ibb.co/My6h0gdd/20250706-230221.png");
            document.getElementById("product-title").textContent = data.name;

            updateRecentlyViewed(data.id);

            mediaItems = [];
            if (data.images && Array.isArray(data.images)) mediaItems.push(...data.images.map(src => ({ type: "image", src })));
            if (data.videoUrl) mediaItems.push({ type: "video", src: data.videoUrl, thumbnail: data.images?.[0] });

            renderMediaGallery();

            if (data.rating && data.reviewCount) {
                document.getElementById("rating-section").style.display = "flex";
                renderStars(data.rating, document.getElementById("product-rating-stars"));
                document.getElementById("product-review-count").textContent = `(${data.reviewCount} ratings)`;
            }

            renderAdvancedHighlights(data.specHighlights);
            renderSimpleDescription(data.description);

            renderVariantSelectors(data.variants);
            setupSliderControls();
            setupQuantityControls();
            setupImageModal();
            setupShareButton();
            setupVariantModal();
            updatePriceDisplay();
            loadSimilarProducts(data.category);
            loadOtherProducts(data.category);
        }

        // MODIFIED: This function now includes the requested style changes.
        function renderAdvancedHighlights(specData) {
            const container = document.getElementById('advanced-highlights-section');
            if (!specData || !specData.blocks || specData.blocks.length === 0) {
                container.style.display = 'none';
                return;
            }

            let html = `<div class="p-4 sm:p-6 lg:p-8">`;
            html += `<h2 class="text-xl font-bold text-gray-900 mb-4">Highlights</h2>`;

            if (specData.specScore || specData.specTag) {
                html += `<div class="flex items-center gap-3 mb-6">`;
                // Change 1: Made spec score bold
                if (specData.specScore) html += `<div class="spec-score font-bold">${specData.specScore}</div>`;
                if (specData.specTag) html += `<div class="spec-tag">${specData.specTag}</div>`;
                html += `</div>`;
            }

            html += `<div class="space-y-6">`;
            specData.blocks.forEach(block => {
                // Change 2: Applied dark yellow color to subtitle
                const subtitleStyle = "color: #B8860B; font-weight: 500;"; // Dark Goldenrod
                html += `<div class="flex items-start gap-4">
                    <div class="flex-shrink-0 w-8 h-8 text-gray-600 pt-1">${block.icon || ''}</div>
                    <div class="flex-grow">
                        <p class="text-sm text-gray-500">${block.category || ''}</p>
                        <h4 class="text-md font-semibold text-gray-800 mt-1">${block.title || ''}</h4>
                        <p class="text-sm mt-1" style="${subtitleStyle}">${block.subtitle || ''}</p>
                    </div>
                </div>`;
            });
            html += `</div></div>`;

            container.innerHTML = html;
            container.style.display = 'block';
        }

        function renderSimpleDescription(descriptionData) {
            const container = document.getElementById("product-description");
            const section = document.getElementById("description-section");
            container.innerHTML = "";

            if (!descriptionData || descriptionData.length === 0) {
                section.style.display = "none";
                return;
            }

            descriptionData.forEach(block => {
                if (block.title || block.details) {
                    let blockHTML = `<div>`;
                    if (block.title) blockHTML += `<h3 class="text-lg font-semibold text-gray-800 mb-2">${block.title}</h3>`;
                    if (block.details) blockHTML += `<p class="text-base text-gray-600 leading-relaxed">${block.details}</p>`;
                    blockHTML += `</div>`;
                    container.innerHTML += blockHTML;
                }
            });
            section.style.display = "block";
        }


        function renderMediaGallery() {
            const gallery = document.getElementById("thumbnail-gallery");
            gallery.innerHTML = "";
            slider.innerHTML = "";
            mediaItems.forEach((item, index) => {
                const slide = document.createElement("div");
                slide.className = "media-item";
                if (item.type === "image") {
                    slide.innerHTML = `<img src="${item.src}" alt="Product image ${index + 1}" draggable="false">`;
                } else if (getYoutubeEmbedUrl(item.src)) {
                    slide.innerHTML = `<iframe src="${getYoutubeEmbedUrl(item.src)}" class="w-full h-auto object-cover aspect-square" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>`;
                }
                slider.appendChild(slide);

                const thumbWrapper = document.createElement("div");
                thumbWrapper.className = "aspect-square thumbnail";
                const img = document.createElement("img");
                img.src = item.type === "image" ? item.src : item.thumbnail;
                thumbWrapper.appendChild(img);

                if (item.type === "video") {
                    const playIcon = document.createElement("div");
                    playIcon.className = "play-icon";
                    playIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="50%" height="50%"><path d="M8 5v14l11-7z"/></svg>';
                    thumbWrapper.appendChild(playIcon);
                }
                thumbWrapper.addEventListener("click", () => showMedia(index));
                gallery.appendChild(thumbWrapper);
            });
            if (mediaItems.length > 0) showMedia(0);
        }

        function renderStars(rating, container) { container.innerHTML = ""; const fullStars = Math.floor(rating), halfStar = rating % 1 >= .5, emptyStars = 5 - fullStars - (halfStar ? 1 : 0); for (let i = 0; i < fullStars; i++)container.innerHTML += '<i class="fas fa-star"></i>'; halfStar && (container.innerHTML += '<i class="fas fa-star-half-alt"></i>'); for (let i = 0; i < emptyStars; i++)container.innerHTML += '<i class="far fa-star"></i>' }
        function updatePriceDisplay() { const basePrice = Number(currentProductData.displayPrice); const originalPrice = Number(currentProductData.originalPrice); document.getElementById("price-final").textContent = `₹${basePrice.toLocaleString("en-IN")}`; const percentageDiscountEl = document.getElementById("price-percentage-discount"); const originalPriceEl = document.getElementById("price-original"); const lowestPriceTag = document.getElementById("lowest-price-tag-container"); if (originalPrice > basePrice) { const discount = Math.round(100 * ((originalPrice - basePrice) / originalPrice)); percentageDiscountEl.innerHTML = `<i class="fas fa-arrow-down mr-1"></i>${discount}%`; originalPriceEl.textContent = `₹${originalPrice.toLocaleString("en-IN")}`; percentageDiscountEl.style.display = "flex"; originalPriceEl.style.display = "inline"; lowestPriceTag.style.display = "block"; } else { percentageDiscountEl.style.display = "none"; originalPriceEl.style.display = "none"; lowestPriceTag.style.display = "none"; } updateOrderLink(); }
        function getYoutubeEmbedUrl(url) { if (!url) return null; let videoId = null; try { const urlObj = new URL(url); if(urlObj.hostname === 'www.youtube.com' || urlObj.hostname === 'youtube.com') { videoId = urlObj.searchParams.get("v"); } else if (urlObj.hostname === 'youtu.be') { videoId = urlObj.pathname.slice(1); } return videoId ? `https://www.youtube.com/embed/${videoId}?controls=1&rel=0&modestbranding=1` : null; } catch (e) { console.error("Invalid video URL:", url, e); return null; } }
        function showMedia(index) { if (index < 0 || index >= mediaItems.length) return; slider.style.transition = "transform 0.3s ease-out", currentMediaIndex = index, currentTranslate = index * -sliderWrapper.offsetWidth, prevTranslate = currentTranslate, setSliderPosition(), document.querySelectorAll(".thumbnail").forEach((thumb, i) => thumb.classList.toggle("active", i === index)) }
        function setupSliderControls() { sliderWrapper.addEventListener("touchstart", touchStart, { passive: !0 }), sliderWrapper.addEventListener("touchend", touchEnd), sliderWrapper.addEventListener("touchmove", touchMove, { passive: !0 }), sliderWrapper.addEventListener("mousedown", touchStart), sliderWrapper.addEventListener("mouseup", touchEnd), sliderWrapper.addEventListener("mouseleave", touchEnd), sliderWrapper.addEventListener("mousemove", touchMove) }
        function touchStart(event) { startPos = getPositionX(event), isDragging = !0, animationID = requestAnimationFrame(animation), slider.style.transition = "none" }
        function touchMove(event) { if (isDragging) { const currentPosition = getPositionX(event); currentTranslate = prevTranslate + currentPosition - startPos } }
        function touchEnd(event) { if (isDragging) { isDragging = !1, cancelAnimationFrame(animationID); const movedBy = currentTranslate - prevTranslate; movedBy < -50 && currentMediaIndex < mediaItems.length - 1 && currentMediaIndex++, movedBy > 50 && currentMediaIndex > 0 && currentMediaIndex--, showMedia(currentMediaIndex) } }
        function getPositionX(event) { return event.type.includes("mouse") ? event.pageX : event.touches[0].clientX }
        function animation() { setSliderPosition(), isDragging && requestAnimationFrame(animation) }
        function setSliderPosition() { slider.style.transform = `translateX(${currentTranslate}px)` }
        function setupQuantityControls() { document.getElementById("increase-quantity").addEventListener("click", () => { productQuantity++, updateOrderLink() }), document.getElementById("decrease-quantity").addEventListener("click", () => { productQuantity > 1 && (productQuantity--, updateOrderLink()) }), updateOrderLink() }
        function updateOrderLink() { document.getElementById("quantity-display").textContent = productQuantity; document.getElementById('decrease-quantity').disabled = productQuantity <= 1; const orderLink = document.getElementById('order-now-link'); if (orderLink) { const variantsQueryString = encodeURIComponent(JSON.stringify(selectedVariants)); orderLink.href = `order.html?id=${currentProductId}&quantity=${productQuantity}&variants=${variantsQueryString}` } }
        function setupImageModal() { const modal = document.getElementById("image-modal"), modalImg = document.getElementById("modal-image-content"), closeBtn = document.querySelector("#image-modal .close"), prevBtn = document.querySelector("#image-modal .prev"), nextBtn = document.querySelector("#image-modal .next"); sliderWrapper.onclick = e => { if (isDragging || currentTranslate - prevTranslate != 0) return; "image" === mediaItems[currentMediaIndex].type && (modal.style.display = "flex", modalImg.src = mediaItems[currentMediaIndex].src) }, closeBtn.onclick = () => modal.style.display = "none"; const showModalImage = direction => { let imageItems = mediaItems.map((item, i) => ({ ...item, originalIndex: i })).filter(item => "image" === item.type); if (0 !== imageItems.length) { const currentImageInFilteredArray = imageItems.findIndex(item => item.originalIndex === currentMediaIndex); let nextImageInFilteredArray = (currentImageInFilteredArray + direction + imageItems.length) % imageItems.length; const nextImageItem = imageItems[nextImageInFilteredArray]; modalImg.src = nextImageItem.src, showMedia(nextImageItem.originalIndex) } }; prevBtn.onclick = e => { e.stopPropagation(), showModalImage(-1) }, nextBtn.onclick = e => { e.stopPropagation(), showModalImage(1) } }
        function setupShareButton() { document.getElementById("share-button").addEventListener("click", async () => { const productName = currentProductData.name.replace(/\*/g, "").trim(), shareText = `*${productName}*\nPrice: *₹${Number(currentProductData.displayPrice).toLocaleString("en-IN")}*\n\n✨ Discover more at Ramazone! ✨\n${window.location.href}`; navigator.share ? await navigator.share({ text: shareText }) : navigator.clipboard.writeText(window.location.href).then(() => showToast("Link Copied!")) }) }
        function showToast(message, type = "info") { const toast = document.getElementById("toast-notification"); toast.textContent = message, toast.style.backgroundColor = "error" === type ? "#ef4444" : "#333", toast.classList.add("show"), setTimeout(() => toast.classList.remove("show"), 2500) }
        function renderVariantSelectors(variants) { const container = document.getElementById("variant-buttons-container"), section = document.getElementById("variant-selection-section"); if (container.innerHTML = "", selectedVariants = {}, !variants || !Array.isArray(variants) || 0 === variants.length) return void (section.style.display = "none"); section.style.display = "block", variants.forEach(variant => { if (variant && variant.type && variant.options) { const button = document.createElement("button"); button.className = "variant-btn w-full p-3 rounded-lg flex justify-between items-center", button.innerHTML = `<span>${variant.type}</span> <i class="fas fa-chevron-down text-xs"></i>`, button.addEventListener("click", () => openVariantModal(variant)), container.appendChild(button) } }) }
        function openVariantModal(variant) { const overlay = document.getElementById("variant-modal-overlay"), titleEl = document.getElementById("variant-modal-title"), bodyEl = document.getElementById("variant-modal-body"); titleEl.textContent = `Select ${variant.type}`, bodyEl.innerHTML = "", variant.options.forEach(option => { const isSelected = selectedVariants[variant.type] === option.name, optionEl = document.createElement("div"); optionEl.className = `variant-option ${isSelected ? "selected" : ""}`; let content = ""; content = "color" === variant.type.toLowerCase() && option.value ? `<div class="color-swatch" style="background-color: ${option.value};"></div> <span class="flex-grow">${option.name}</span>` : `<span>${option.name}</span>`, optionEl.innerHTML = content, optionEl.addEventListener("click", () => { selectedVariants[variant.type] = option.name, updateVariantButtonDisplay(variant.type, option.name), updateOrderLink(), closeVariantModal() }), bodyEl.appendChild(optionEl) }), overlay.classList.remove("hidden"), setTimeout(() => overlay.classList.add("active"), 10) }
        function closeVariantModal() { const overlay = document.getElementById("variant-modal-overlay"); overlay.classList.remove("active"), setTimeout(() => overlay.classList.add("hidden"), 300) }
        function updateVariantButtonDisplay(type, value) { const container = document.getElementById("variant-buttons-container"); container.querySelectorAll("button").forEach(button => { button.textContent.includes(type) && (button.innerHTML = `<span>${type}: <span class="value">${value}</span></span> <i class="fas fa-chevron-down text-xs"></i>`) }) }
        function setupVariantModal() { const overlay = document.getElementById("variant-modal-overlay"); document.getElementById("variant-modal-close").addEventListener("click", closeVariantModal), overlay.addEventListener("click", e => { e.target === overlay && closeVariantModal() }) }
        function createCarouselCard(product) { const ratingTag = product.rating ? `<div class="card-rating-tag">${product.rating} <i class="fas fa-star"></i></div>` : "", originalPriceNum = Number(product.originalPrice), displayPriceNum = Number(product.displayPrice), discount = originalPriceNum && originalPriceNum > displayPriceNum ? Math.round(100 * ((originalPriceNum - displayPriceNum) / originalPriceNum)) : 0; return `\n                <a href="?id=${product.id}" class="carousel-item block bg-white rounded-lg shadow overflow-hidden transform hover:-translate-y-1 transition-transform duration-300">\n                    <div class="relative">\n                        <img src="${product.images?.[0] || "https://i.ibb.co/My6h0gdd/20250706-230221.png"}" class="w-full object-cover aspect-square" alt="${product.name}">\n                        ${ratingTag}\n                    </div>\n                    <div class="p-2">\n                        <h4 class="text-sm font-semibold truncate text-gray-800 mb-1">${product.name}</h4>\n                        <div class="flex items-baseline gap-2">\n                            <p class="text-base font-bold" style="color: var(--primary-color)">₹${displayPriceNum.toLocaleString("en-IN")}</p>\n                            ${originalPriceNum > displayPriceNum ? `<p class="text-xs text-gray-400 line-through">₹${originalPriceNum.toLocaleString("en-IN")}</p>` : ""}\n                        </div>\n                        ${discount > 0 ? `<p class="text-xs font-semibold text-green-600 mt-1">${discount}% OFF</p>` : ""}\n                    </div>\n                </a>` }
        function createGridCard(product) { const ratingTag = product.rating ? `<div class="card-rating-tag">${product.rating} <i class="fas fa-star"></i></div>` : "", originalPriceNum = Number(product.originalPrice), displayPriceNum = Number(product.displayPrice), discount = originalPriceNum && originalPriceNum > displayPriceNum ? Math.round(100 * ((originalPriceNum - displayPriceNum) / originalPriceNum)) : 0; return `\n                <a href="?id=${product.id}" class="block bg-white rounded-lg shadow overflow-hidden transform hover:-translate-y-1 transition-transform duration-300">\n                    <div class="relative">\n                        <img src="${product.images?.[0] || "https://i.ibb.co/My6h0gdd/20250706-230221.png"}" class="w-full h-auto object-cover aspect-square" alt="${product.name}">\n                        ${ratingTag}\n                    </div>\n                    <div class="p-2 sm:p-3">\n                        <h4 class="text-sm font-semibold truncate text-gray-800 mb-1">${product.name}</h4>\n                        <div class="flex items-baseline gap-2">\n                            <p class="text-base font-bold" style="color: var(--primary-color)">₹${displayPriceNum.toLocaleString("en-IN")}</p>\n                            ${originalPriceNum > displayPriceNum ? `<p class="text-xs text-gray-400 line-through">₹${originalPriceNum.toLocaleString("en-IN")}</p>` : ""}\n                        </div>\n                        ${discount > 0 ? `<p class="text-sm font-semibold text-green-600 mt-1">${discount}% OFF</p>` : ""}\n                    </div>\n                </a>` }
        function updateRecentlyViewed(newId) { let viewedIds = JSON.parse(sessionStorage.getItem("ramazoneRecentlyViewed")) || []; viewedIds = viewedIds.filter(id => id !== newId); viewedIds.unshift(newId); viewedIds = viewedIds.slice(0, 10); sessionStorage.setItem("ramazoneRecentlyViewed", JSON.stringify(viewedIds)); loadRecentlyViewed(viewedIds); }
        function loadRecentlyViewed(viewedIds) { const container = document.getElementById("recently-viewed-container"); const section = document.getElementById("recently-viewed-section"); if (!container || !section) return; container.innerHTML = ""; if (viewedIds && viewedIds.length > 1) { let cardCount = 0; viewedIds.filter(id => id != currentProductId).forEach(id => { const product = allProductsCache.find(p => p.id == id); if (product) { container.innerHTML += createCarouselCard(product); cardCount++; } }); if (cardCount > 0) { section.style.display = "block"; } else { section.style.display = "none"; } } else { section.style.display = "none"; } }
        function loadSimilarProducts(category) { if (category && allProductsCache) { const container = document.getElementById("similar-products-container"); container.innerHTML = ""; let cardCount = 0; allProductsCache.forEach(product => { product && product.category === category && product.id != currentProductId && (container.innerHTML += createCarouselCard(product), cardCount++) }), cardCount > 0 && (document.getElementById("similar-products-section").style.display = "block") } }
        function loadOtherProducts(currentCategory) { const otherProducts = allProductsCache.filter(p => p.category !== currentCategory && p.id != currentProductId).map(p => { const discount = Number(p.originalPrice) > Number(p.displayPrice) ? 100 * ((Number(p.originalPrice) - Number(p.displayPrice)) / Number(p.originalPrice)) : 0, rating = p.rating || 0, score = 5 * rating + .5 * discount; return { ...p, score: score } }).sort((a, b) => b.score - a.score).slice(0, 20), container = document.getElementById("other-products-container"); container.innerHTML = "", otherProducts.length > 0 && (otherProducts.forEach(product => { container.innerHTML += createGridCard(product) }), document.getElementById("other-products-section").style.display = "block") }
    </script>
</body>
</html>
